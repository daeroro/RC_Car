Static Memory Controller


11.1 Introduction


정적 메모리 컨트롤러 (SMC)는 다음과 같은 메모리 유형을 지원하는 NAND 플래시 컨트롤러 

또는 병렬 포트 메모리 컨트롤러로 사용할 수 있습니다.

- NAND 플래시

- 비동기 SRAM

- NOR 플래시

시스템 버스 마스터는 그림 11-1과 같이 SMC 컨트롤러에 액세스 할 수 있습니다. 

SMC의 작동 레지스터는 APB 인터페이스를 통해 구성됩니다. SMC에 대한 메모리 매핑은 4 장, 시스템 주소에서 설명합니다. 

SMC는 모든 명령, 주소, 데이터 및 메모리 장치 프로토콜을 처리합니다. 사용자가 작동 레지스터를 읽거나 쓰면 

컨트롤러에 액세스 할 수 있습니다. 

SMC는 ARM의 PL353 정적 메모리 컨트롤러를 기반으로합니다.


11.1.1 Features


각 유형의 메모리에 대해 SMC의 기능이 나열됩니다. 

컨트롤러는 두 가지 인터페이스 모드 중 하나에서 작동하도록 구성됩니다.


NAND Flash Interface

- ONFI 사양 1.0

- 최대 1GB 장치

- 단일 칩 선택으로 8/16 비트 IO 폭

- 16 워드 읽기 및 16 워드 쓰기 데이터 FIFO

- 8 워드 명령 FIFO

- 프로그래밍 가능한 IO 사이클 타이밍

- 소프트웨어 지원 기능이있는 1 비트 ECC 하드웨어

- 비동기 메모리 작동 모드


Parallel (SRAM/NOR) Interface

- 8 비트 데이터 버스 폭

- 최대 25 개의 주소 신호 (32 MB)로 하나의 칩 선택

- 최대 25 개의 주소 (32 + 32 MB)가있는 2 개의 칩 선택

- 16 워드 읽기 및 16 워드 쓰기 데이터 FIFO

- 8 워드 명령 FIFO

- 칩 선택 기준으로 프로그래밍 가능한 I / O 사이클 타이밍

- 비동기 메모리 작동 모드


11.1.2 Block Diagram 



Interconnect Interfaces


NOR / SRAM 컨트롤러 모드의 경우, AXI 인터페이스는 메모리 매핑되어있어 소프트웨어가 메모리에서 읽고 쓸 수 있습니다. 

NAND 플래시 컨트롤러 모드의 경우, 소프트웨어는 AXI 인터페이스를 통해 NAND 컨트롤러에 명령을 기록합니다. 

자세한 내용은 ARM 사양을 참조하십시오.

APB 버스 인터페이스는 소프트웨어가 제어 및 상태 레지스터를 읽고 쓸 수있는 메모리 매핑 영역을 제공합니다.


Memory Manager


메모리 관리자는 CPU_1x 클럭 도메인 상태 머신의 현재 상태를 추적하고 제어합니다. 

이 블록은 메모리 클록 도메인에서 사용되는 레지스터 값을 업데이트하고 APB 인터페이스를 통해 

메모리로 발행 된 직접 명령을 제어하고 절전 모드에서 진입 및 종료를 제어합니다.


Format


포맷 블록은 AXI 슬레이브 인터페이스와 메모리 관리자의 메모리 액세스를 중재합니다. 

관리자의 요청이 가장 우선 순위가 높습니다. AR 및 AW 채널의 요청은 라운드 로빈 방식으로 중재됩니다. 

포맷 블록은 AXI 전송을 적절한 메모리 전송으로 매핑하고이를 명령 FIFO를 통해 메모리 인터페이스로 전달합니다.



11.1.3 Notices 


7z007s and 7z010 CLG225 Devices

7z007s 싱글 코어 7z010 듀얼 코어 CLG225 디바이스는 NOR / SRAM 인터페이스를 지원하지 않습니다. 

NAND 인터페이스는 8 비트 인터페이스에서는 지원되지만 16 비트 인터페이스에서는 지원되지 않습니다.


MIO Pin Options


MIO 핀 1은 NOR / SRAM 컨트롤러의 CS1 또는 어드레스 비트 25가되도록 프로그래밍 할 수 있습니다. 

이 핀은 또한 GPIO로 프로그래밍 할 수 있습니다. 프로그래밍은 slcr.MIO_PIN_01 레지스터에 의해 제어됩니다. 

2 개의 NOR 소자가 시스템에있을 때이 핀을 CS1에 프로그래밍한다. 디바이스가 32MB보다 클 때 

비트 25를 주소 지정하기 위해이 핀을 프로그램하지만, 기능에는 자일링스 AR # 60848에서 설명한대로 

두 가지 해결 방법 중 하나가 필요하다. 

표 11-1은 SMC가 NOR / SRAM에서 작동하는 방법을 요약 한 것이다


11.2 Functional Operation 


SMC의 기능 작동은 ARM 정적 메모리 컨트롤러 (PL350 시리즈) 기술 참조 설명서에 설명되어 있습니다. 

추가 정보는 다음 절에서 제공됩니다.


11.2.1 Boot Device 


NOR 및 NAND 플래시 컨트롤러는 부팅 장치로 구성 될 수 있습니다. 메모리 인터페이스는 MIO를 통해서만 라우팅 될 수 있습니다.


11.2.2 Clocks 


SMC에는 CPU_1x 및 SMC_Ref 클럭으로 구동되는 두 개의 클럭 도메인이 있습니다 (표 11-2 참조). 

이 클럭은 클록 제너레이터에 의해 제어되며, 제 25 장 클럭을 참조하십시오. 두 클럭 도메인은 서로 비동기 적입니다. 

비동기 클럭킹의 주요 이점은 고정 시스템 주파수에서 상호 연결 인터페이스를 실행하는 동안 메모리 성능을 극대화하는 것입니다.


TIP : 전원 관리를 위해 slcr 레지스터의 클럭 인 에이블을 사용하여 클록을 끌 수 있습니다. 기준 클록의 동작 주파수는 데이터 시트에 정의되어있다. 

(클럭 게이팅은 전력을 절약하기 위해 클록을 정지시키는 데 사용됩니다.)


11.2.3 Resets 


컨트롤러에는 리셋 서브 시스템에 의해 제어되는 2 개의 리셋 입력이 있습니다. 26 장, 시스템 재설정을 참조하십시오. 

이 SMC CPU_1x 재설정은 AXI 및 APB 인터페이스에 사용됩니다. 

SMC_Ref 리셋은 FIFO 및 제어 및 상태 레지스터를 포함한 컨트롤러의 나머지 부분에 대한 것입니다.


11.2.4 ECC Support 



사용자 코드는 낸드 장치가 플래시 장치의 제조업체 및 장치 ID를 읽음으로써 온칩 ECC를 포함하는지 여부를 결정할 수 있습니다. 

지원되는 부팅 장치는 Xilinx AR50991에 나열되어 있습니다. NAND 장치의 공급 업체 사양은 ECC 지원을 위해 검토해야합니다. 

온칩 ECC 오류는 NAND 인터럽트를 사용하여 플래그됩니다.

플래시 장치가 온 칩 ECC를 지원하지 않으면 SMC 컨트롤러의 1 비트 ECC 장치를 사용할 수 있습니다. 

프로그래밍 정보는 ARM PrimeCell 정적 메모리 컨트롤러 (PL350 시리즈) 기술 참조 설명서, 개정판 r2p1을 참조하십시오. 

SMC 컨트롤러가 감지 한 ECC 오류는 ECC 인터럽트로 플래그됩니다.

NAND를 프로그래밍 할 때, SMC 컨트롤러는 ECC 블록 (512 바이트 = 4096 비트)에서 1의 수가 (비트 = 1) 홀수 인 경우 

ECC 코드의 반전을 추가합니다. 하드웨어 동작을 맞추기 위해 소프트웨어는 ECC 블록 (512 바이트 = 4096 비트)에서 

1의 수가 (짝수) 인 경우 ECC 코드의 반전을 추가해야합니다.


11.2.5 Interrupts 


컨트롤러는 3 개의 인터럽트 소스를 포함합니다. 이러한 인터럽트는 smc.MEMC_STATUS 레지스터에 의해 제어됩니다. 

활성화되면 인터럽트는 IRQ ID # 50 신호를 시스템 인터럽트 컨트롤러에 생성합니다.

- NAND ECC는 SMC ECC 로직에 의해 트리거됩니다.

- NAND 인터럽트는 MIO의 NAND_BUSY 입력 핀의 상승 에지에서 트리거됩니다.

- SRAM 인터럽트는 PL의 EMIOSRAMINTIN 신호 상승 에지에서 트리거됩니다. 

  인터럽트의 원인은 smc.MEMC_STATUS 레지스터를 읽음으로써 결정됩니다.


11.2.6 PL353 Functionality 


SMC는 ARM의 PL353 Primecell 코어를 기반으로하며 컨트롤러 0은 SRAM / NOR 모드에서 작동하고 컨트롤러 1은 NAND 플래시 모드에서 

작동 할 수 있도록 하드 코딩되어 있습니다. SRAM / NOR 또는 NAND 인터페이스는 시스템에서 사용할 수 있지만 둘 다 사용할 수는 없습니다. 

SRAM / NOR 인터페이스는 PSRAM을 지원하지 않습니다. NAND 플래시 컨트롤러는 마모 균등화를 지원하지 않습니다.

프로그래밍 및 기타 용도로 ARM 설명서를 참조 할 때는 표 11-3의 구현 정보를 참조하십시오.



11.2.7 Address Map


표 11-4에는 레지스터 및 메모리 기본 주소가 나열되어 있습니다.



11.3 I/O Signals 


SRAM / NOR 및 NAND 플래시 연결에 대한 MIO 핀 할당은 표 11-5에 나와 있습니다. SMC 인터페이스 신호는 MIO 핀으로 만 라우팅되며 

EMIO 인터페이스에서는 사용할 수 없습니다. MIO 핀과 제한 사항 (NOR / SRAM 없음 및 8 비트 NAND 제외)은 MIO 

표 2.5.4 MIO-at-a-Glance Table의 MIO 표에 나와 있습니다.

Optional Pins

SRAM 또는 NOR의 경우 상위 주소 비트는 선택 사항입니다. 사용하지 않으면 다른 기능에 할당 할 수 있습니다.



11.4 Wiring Diagrams 


SMC는 그림 11-3, 그림 11-4 및 그림 11-5에 표시된 구성을 지원합니다. 

SMC의 NOR / SRAM 모드는 칩 선택 0과 1을 사용하는 2 개의 장치 (NOR 및 / 또는 SRAM)를 지원할 수 있습니다.


11.5 Register Overview 

SMC 레지스터는 표 11-6에 요약되어 있습니다.

Table 11-6: SMC Register Overview


Controller			Register Name					Description

				MEMC STATUS					작동 및 인터럽트 상태, 읽기 전용 
				MEMIF_CFG 					SMC 구성 정보, 읽기 전용
				MEMC_CFG_{SET, CLR}				인터럽트를 활성화 / 비활성화 / 지우고 저전력 상태를 제어합니다				
Both				DIRECT_CMD 					쓰기 전용 set 명령을 실행하십시오
				SET_{CYCLES, OPMODE}				SRAM / NOR 및 NAND 플래시 레지스터에 사이클 또는 opmode 작업 수행
				USER_{STATUS, CONFIG}


				REFRESH_PERIOD_{0,1}				SRAM / NOR 버스트 사이클 사이에 유휴 사이클 삽입 
SRAM/NOR CS 0, 1		SRAM_CYCLES0_{0,1} 				타이밍 사이클
				OPMODE0_{0,1}					작동 모드


				NAND_CYCLES1_0 					타이밍 사이클
NAND Flash			OPMODE1_0 					작동 모드
				ECC_{STATUS, MEMCFG}_1 				ECC 상태 및 구성
				ECC_MEMCOMMAND{2:1}_1 				ECC 읽기 및 쓰기에 사용되는 명령
				ECC_ADDR{1:0}_1 				컨트롤러에 의해 생성 된 주소
				ECC_VALUE{3:0}_1				컨트롤러에 의해 생성 된 값



11.6 Programming Model 


프로그래밍 모델은 ARM 정적 메모리 컨트롤러 (PL350 시리즈) 기술 참조 설명서 (부록 A, 추가 리소스 참조)에 설명되어 있습니다. 

SMC의 구성은 표 11-3에 요약되어 있습니다.


11.7 NOR Flash Bandwidth 


NOR 플래시의 대역폭 측정 세부 사항은 다음과 같습니다.

환경 : 				    독립 실행 형

NOR 플래시 장치 사용 : 		    PC28F256M29EW

SMC (NOR 플래시 컨트롤러) 클럭 :    100 MHz

데이터 전송 크기 		    1MB

달성 된 대역폭 :

대역폭 읽기			    9.02 MB/S 

쓰기 대역폭   			    7.36 KB/S 


